# 四则运算计算器的实现报告

## 设计思路

本程序的目标是基于 C++ 设计一个能够实现两个数的加、减、乘、除运算的计算器，同时支持存储值功能，并满足用户多次交互的需求。以下是设计过程中的主要思路和创新点。

### 功能实现
1. **基本功能**：
   - 支持输入两个数及运算符 (`+`, `-`, `*`, `/`)。
   - 支持打印计算结果，并支持连续计算。
   - 支持基本内存操作，包括存储值、回显存储值、清空存储值和对存储值的加减运算。
   - 可随时退出程序（输入一个井号 `#`）。

2. **鲁棒性**：
   - 提供全面的输入验证，处理语法错误（如缺少运算符、无效字符等），例如：
     ```
     abcd
     1++2
     1+2+3
     +1+
     ```
   - 允许小数点的特殊用法，例如：
     ```
     .12+.34
     56.+78.
     ```
   - 允许负号的叠加（负负得正），例如：
     ```
     --123+456
     123+---456
     ```
   - 允许在输入中穿插任意个空格，例如：
     ```
     123 + 456
       123  +  456
     ```
   - 允许只输入一个数字，此时直接回显其本身。
   - 输入的 `M` 开头的内存操作符对大小写不敏感。
   - 防止输入时数值溢出，或运算时算术溢出。
   - 防止除数为零。

3. **友好界面**：
   - 输入提示符 (`>>>`) 和结果提示符 (`<<<`)。
   - 针对错误提供清晰的提示信息。

### 创新设计
1. **处理大范围数值**：
   - 使用 `long double` 类型处理数值。
   - 引入了自定义封装的 `Number` 类，专门管理数值及其状态（如溢出、除零或正常）。
   - 通过某些溢出判断逻辑，增强计算的准确性。

2. **逐字符解析的输入处理**：
   - 通过 `NumberReader` 类，逐字符解析用户输入。
   - 解决了小数点、正负号和 `M` 开头的内存操作符识别的细节问题。

3. **模块化设计**：
   - 通过 `Number` 和 `Expression` 模块，将核心逻辑（如运算、解析输入）与程序主流程分离，提升了代码可读性和维护性，便于未来功能扩展。
   - 明确划分了输入解析、结果计算、内存管理和输出展示的功能，逻辑清晰。

4. **基本内存管理**：
   - 提供了用户操作存储值的功能（如 `M+`，`M-`，`MC` 和 `MR`），提升了用户体验。

## 测试案例

加法：

```
>>> 123+456
<<< 579

>>> 789+-123
<<< 666

>>> 9000000000000000+9000000000000000
<<< 18000000000000000

>>> 10000000000000000+10000000000000000
Error: Numerical overflowed!
```

减法：
```
>>> 123-456
<<< -333

>>> -789--123
<<< -666

>>> -9000000000000000-9000000000000000
<<< -18000000000000000

>>> -10000000000000000-10000000000000000
Error: Numerical overflowed!
```

乘法：

```
>>> 123*456
<<< 56088

>>> 1.2*0.000000000001
<<< 0.0000000000012

>>> 1.2*0.000000000000000000000001
Error: Numerical overflowed!

>>> 90000000000*9000000000
Error: Arithmetic overflowed!
```

除法：

```
>>> 1/3
<<< 0.33333333333333

>>> 1/4
<<< 0.25

>>> 1/0
Error: Cannot divided by zero!

>>> 1.2/0.000000000000003
<<< 400000000000000

>>> 1.2/0.0000000000000003
Error: Numerical overflowed!
```

## 总结

本计算器程序功能完善，代码编写成熟，代码样式良好，具有高度的健壮性和用户友好性，同时代码的模块化设计便于维护与扩展。

> 相关代码已开源至 GitHub： https://github.com/isHarryh/USTB-Term-Projects/tree/main/CppProgramming
